# ARM64 build Dockerfile for GitHub Actions
FROM arm64v8/ubuntu:22.04 AS builder

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    build-essential cmake git pkg-config \
    libboost-all-dev libssl-dev libevent-dev libsqlite3-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /build
COPY . .

# Build
RUN cmake -B build \
    -DBUILD_TESTING=OFF \
    -DENABLE_IPC=OFF \
    -DWITH_ZMQ=OFF \
    -DENABLE_WALLET=ON \
    && cmake --build build -j$(nproc)

RUN strip build/bin/botcoind build/bin/botcoin-cli

# Copy to output
FROM scratch AS export
COPY --from=builder /build/build/bin/botcoind /botcoind
COPY --from=builder /build/build/bin/botcoin-cli /botcoin-cli
